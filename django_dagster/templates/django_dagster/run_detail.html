{% extends "django_dagster/base.html" %}
{% load i18n %}

{% block content_title %}<h1>{{ title }}</h1>{% endblock %}

{% block dagster_breadcrumbs %}
&rsaquo; <a href="{% url 'admin:django_dagster_dagsterrun_changelist' %}">{% trans 'Runs' %}</a>
&rsaquo; {{ run.runId }}
{% endblock %}

{% block dagster_content %}
<fieldset class="module aligned">
    <h2>{% trans 'Run Details' %}</h2>
    <div class="form-row">
        <div>
            <label>{% trans 'Run ID:' %}</label>
            <div class="readonly"><code>{{ run.runId }}</code></div>
        </div>
    </div>
    <div class="form-row">
        <div>
            <label>{% trans 'Job:' %}</label>
            <div class="readonly">{{ run.jobName }}</div>
        </div>
    </div>
    <div class="form-row">
        <div>
            <label>{% trans 'Status:' %}</label>
            <div class="readonly"><span class="status-badge status-{{ run.status }}">{{ run.status }}</span></div>
        </div>
    </div>
    <div class="form-row">
        <div>
            <label>{% trans 'Started:' %}</label>
            <div class="readonly">{{ run.startTime|default:"—" }}</div>
        </div>
    </div>
    <div class="form-row">
        <div>
            <label>{% trans 'Ended:' %}</label>
            <div class="readonly">{{ run.endTime|default:"—" }}</div>
        </div>
    </div>
    {% if run.stats %}
    <div class="form-row">
        <div>
            <label>{% trans 'Steps succeeded:' %}</label>
            <div class="readonly">{{ run.stats.stepsSucceeded|default:"0" }}</div>
        </div>
    </div>
    <div class="form-row">
        <div>
            <label>{% trans 'Steps failed:' %}</label>
            <div class="readonly">{{ run.stats.stepsFailed|default:"0" }}</div>
        </div>
    </div>
    <div class="form-row">
        <div>
            <label>{% trans 'Materializations:' %}</label>
            <div class="readonly">{{ run.stats.materializations|default:"0" }}</div>
        </div>
    </div>
    {% endif %}
    {% if run.tags %}
    <div class="form-row">
        <div>
            <label>{% trans 'Tags:' %}</label>
            <div class="readonly">
                {% for tag in run.tags %}
                <span style="display:inline-block;background:var(--darkened-bg);padding:2px 6px;margin:2px;border-radius:3px;font-size:12px;">{{ tag.key }}={{ tag.value }}</span>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    {% if run.runConfigYaml %}
    <div class="form-row">
        <div>
            <label>{% trans 'Run config:' %}</label>
            <div class="readonly"><pre class="dagster-config">{{ run.runConfigYaml }}</pre></div>
        </div>
    </div>
    {% endif %}
</fieldset>

{% if related_runs %}
<div class="inline-related tabular">
<fieldset class="module">
    <h2>{% trans 'Recent Runs for' %} {{ run.jobName }}</h2>
    <table>
        <thead>
            <tr>
                <th>{% trans 'Run ID' %}</th>
                <th>{% trans 'Status' %}</th>
                <th>{% trans 'Started' %}</th>
                <th>{% trans 'Ended' %}</th>
            </tr>
        </thead>
        <tbody>
            {% for r in related_runs %}
            <tr{% if r.runId == run.runId %} style="font-weight:bold;"{% endif %}>
                <td><a href="{% url 'admin:django_dagster_dagsterrun_change' r.runId %}">{{ r.runId }}</a></td>
                <td><span class="status-badge status-{{ r.status }}">{{ r.status }}</span></td>
                <td>{{ r.startTime|default:"—" }}</td>
                <td>{{ r.endTime|default:"—" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</fieldset>
</div>
{% endif %}

<div class="submit-row">
    {% if can_cancel %}
    <form method="post" action="{% url 'admin:django_dagster_dagsterrun_cancel' run.runId %}" style="display:inline;">
        {% csrf_token %}
        <input type="submit" value="{% trans 'Cancel Run' %}" onclick="return confirm('{% trans 'Cancel this run?' %}')">
    </form>
    {% endif %}
    {% if can_retry %}
    <form method="post" action="{% url 'admin:django_dagster_dagsterrun_retry' run.runId %}" style="display:inline;">
        {% csrf_token %}
        <input type="submit" value="{% trans 'Retry Run' %}">
    </form>
    {% endif %}
    <form method="get" action="{% url 'admin:django_dagster_dagsterrun_changelist' %}" style="display:inline;">
        <input type="submit" value="{% trans 'All Runs' %}">
    </form>
</div>
{% endblock %}
